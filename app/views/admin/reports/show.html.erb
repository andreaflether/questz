<div class="card border-top-primary">
  <div class="card-header d-flex align-items-center justify-content-between bg-white">
    <p class="mb-0 py-2">
      <i class="fas fa-flag me-2"></i>
      Report n. <b>#<%= @report.number %></b>
    </p>
    <span class="badge bg-<%= get_class_for_report_status(@report.status) %>">
      <%= @report.status.humanize %>
    </span>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <h6>Report info</h6>
        <hr class="dropdown-divider">
        <dl class="row">
          <dt class="col-sm-4">Reason</dt>
          <dd class="col-sm-8"><%= @report.reason.humanize %></dd>
          <dt class="col-sm-4">Reported on</dt>
          <dd class="col-sm-8"><%= l(@report.created_at.localtime, format: :long) %></dd>
          <dt class="col-sm-4">Assigned to</dt>
          <dd class="col-sm-8"><%= @report.assigned_user ? @report.assigned_user.username : '-' %></dd>
        </dl>
      </div>
      <div class="col-md-6">
        <h6>Reporter info</h6>
        <hr class="dropdown-divider">
        <dl class="row">
          <dt class="col-sm-4">User</dt>
          <dd class="col-sm-8">
            <%= @report.user.name %> (@<%= @report.user.username %>)
            <%= link_to profile_path(@report.user), target: '_blank' do %>
            <i class="fas fa-external-link-alt ms-2"></i>
          <% end %>
          </dd>
          <dt class="col-sm-4">Last signed in</dt>
          <dd class="col-sm-8"><%= l(@report.user.last_sign_in_at.localtime, format: :long) %></dd>
          <dt class="col-sm-4">Member since</dt>
          <dd class="col-sm-8">
            <%= time_ago_in_words(@report.user.created_at.localtime) %> ago
            (<%= format_date(@report.user.created_at.localtime) %>)
          </dd>
        </dl>
      </div>
      <div class="col-md-12 mt-3">
        <h6>Reported content info (<%= @report.reportable_type %>)</h6>
        <hr class="dropdown-divider">
        <div class="row mt-3">
          <div class="col-md-9">
            <h6>
              <%= @report.reportable.title %>
              <%= link_to question_path(@report.reportable), target: '_blank' do %>
                <i class="fas fa-external-link-alt ms-2"></i>
              <% end %>
            </h6>
            <div class="question-body trix-content">
              <%= sanitize @report.reportable.body %>
            </div>
          </div>
          <div class="col-md-3">
            <ul class="list-group list-group-horizontal text-secondary">
              <li class="list-group-item flex-fill">
                <i class="fas fa-caret-up fa-lg me-1"></i> <%= @report.reportable.cached_votes_up %> 
              </li>
              <li class="list-group-item flex-fill">
                <i class="fas fa-caret-down fa-lg me-1"></i> <%= @report.reportable.cached_votes_down %> 
              </li>
              <li class="list-group-item flex-fill">
                <i class="fas fa-eye me-1"></i> <%= @report.reportable.impressions_count %> 
              </li>
              <li class="list-group-item flex-fill">
                <i class="fas fa-comment me-1"></i> <%= @report.reportable.answers_count %>
              </li>
            </ul>
            <dl class="row mt-3">
              <dt class="col-sm-4">Status</dt>
              <dd class="col-sm-8 text-end">
                <span class="badge bg-<%= get_class_for_question_status(@report.reportable.status) %>">
                  <%= @report.reportable.status.humanize %>
                  <% if @report.reportable.closed? %>
                  - <%= @report.reportable.closing_notice.humanize %>
                  <% end %>
                </span>
              </dd>
            </dl>
            <div class="question-actions">
              <h6>Question actions</h6>
              <hr class="dropdown-divider">
              <div class="d-flex gap-1 mt-2">
                <%= get_button_with_confirmation(
                  admin_question_path(@report.reportable),
                  'delete',
                  t('messages.confirmations.delete', resource: 'question'),
                  'Delete',
                  'btn btn-sm btn-danger'
                ) %>

                <%= link_to 'Close', 
                  close_modal_admin_question_path(@report.reportable),
                  remote: true,
                  class: 'btn btn-sm btn-warning' 
                %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="card-footer bg-white py-3">
    <%= link_to assign_admin_report_path, class: 'btn btn-sm btn-info' do %>
      Assign
    <% end %>
    <%= link_to close_admin_report_path, class: 'btn btn-sm btn-danger' do %>
      Close
    <% end %>
    <%= link_to solve_admin_report_path, class: 'btn btn-sm btn-success' do %>
      Mark as solved
    <% end %>
  </div>
</div>

<%= render 'admin/questions/close_modal' %>